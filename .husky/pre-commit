#!/usr/bin/env sh
# Husky v9+/v10-safe pre-commit hook
set -e

# Resolve repo root and app dir
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
PROJECT_DIR="$REPO_ROOT/unify_trucking_db"

# 1) Auto-fix staged files at repo root
cd "$REPO_ROOT"
npx lint-staged

# 2) Lint + typecheck inside the app (or at root if app isn't in a subfolder)
if [ -f "$PROJECT_DIR/package.json" ]; then
  cd "$PROJECT_DIR"
fi

npm run -s lint
npx tsc -p tsconfig.json --noEmit
